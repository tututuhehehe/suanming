# 🔮 六爻 AI 算命系统

> 传统智慧 × 现代 AI — 把玄学变成工程

一个基于**规则引擎 + 大语言模型**的六爻占卜系统。核心理念：**LLM 不做推理，只做翻译**——真正的算命逻辑由 Python 精确计算，AI 负责把结构化结果转化为自然语言解读。

## 🎬 演示

https://github.com/tututuhehehe/--/raw/main/demo.mp4

> 💡 如果视频无法播放，请[点击这里](https://github.com/tututuhehehe/--/raw/main/demo.mp4)下载观看

## ✨ 特性

- 🎲 **真实模拟** - 铜钱起卦动画，还原传统仪式感
- 📊 **五维分析** - 用神定位、旺衰评分、动爻生克、世应关系、六神细节
- 🧮 **量化评分** - 每爻 0-100 能量值，有据可依
- 🤖 **AI 解读** - 通义千问流式输出，专业又通俗
- 💬 **多轮追问** - 支持基于同一卦象继续追问
- 📜 **历史记录** - 本地存储，支持 JSON/CSV 导出

## 🏗️ 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户交互层                            │
│                     main.py (Rich CLI)                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        核心引擎层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐   │
│  │ divination  │ │   najia     │ │  analysis_engine    │   │
│  │  _engine    │ │  _engine    │ │   (五维分析)         │   │
│  │  (起卦)     │ │  (纳甲排盘)  │ │                     │   │
│  └─────────────┘ └─────────────┘ └─────────────────────┘   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐   │
│  │  hexagram   │ │   ganzhi    │ │    llm_client       │   │
│  │  _analyzer  │ │ (干支计算)   │ │   (AI 调用)         │   │
│  └─────────────┘ └─────────────┘ └─────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        知识库层                              │
│   hexagrams.json │ yao_ci.json │ najia.json │ bagua.json   │
│   divination_rules.json │ modern_mapping.json              │
└─────────────────────────────────────────────────────────────┘
```

### 核心设计：静态知识 + 动态计算

| 层级 | 内容 | 特点 |
|------|------|------|
| **静态知识** | 64卦卦辞、384爻辞、断卦规则 | JSON 存储，不变 |
| **动态计算** | 旺衰评分、世应关系、吉凶判断 | 每次起卦实时计算 |
| **AI 表达** | 自然语言解读 | 基于结构化数据生成 |

## 🚀 快速开始

### 1. 克隆项目

```bash
git clone https://github.com/tututuhehehe/--.git
cd --
```

### 2. 安装依赖

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 3. 配置 API

编辑 `config.json`：

```json
{
  "dashscope_api_key": "sk-your-api-key",
  "model": "qwen-plus"
}
```

> 获取 API Key: [阿里云灵积平台](https://dashscope.console.aliyun.com/)

### 4. 运行

```bash
python main.py
```

## 📖 使用示例

```
═══════════════════ 起卦准备 ═══════════════════

请输入您想占卜的问题: 最近能升职吗？
请选择问事类型：事业

═══════════════════ 摇卦中 ═══════════════════

  初爻：🪙 ⚪ ⚪ → 少阴 ━ ━
  二爻：🪙 🪙 ⚪ → 少阳 ━━━
  三爻：🪙 🪙 🪙 → 老阳 ━━━ ○
  ...

═══════════════════ 五维分析 ═══════════════════

用神：官鬼 （第3爻） 评分：75/100
状态：旺相有力，得月生扶
世应：世克应，我方占优势
吉凶：小吉 - 用神有气，事可成

═══════════════════ 大师解读 ═══════════════════

📌 卦象总论：本卦为天火同人...
🎯 用神分析：问事业以官鬼为用...
...
```

## 🧮 五维分析算法

系统模拟真人算命师的分析流程：

### 1️⃣ 取用神
根据问题类型自动定位关键爻：

| 问事类型 | 用神 | 原神 | 忌神 |
|---------|------|------|------|
| 事业 | 官鬼 | 妻财 | 子孙 |
| 财运 | 妻财 | 子孙 | 兄弟 |
| 感情 | 妻财/官鬼 | - | - |
| 健康 | 世爻 | - | 官鬼 |

### 2️⃣ 算旺衰
每爻能量值计算公式：

```
能量 = 基础分(旺100/相80/休50/囚30/死10)
     + 月生(+20) / 月克(-25)
     + 日生(+15) / 日克(-15)
     + 回头生(+30) / 回头克(-40)
```

### 3️⃣ 看动爻
分析变爻的生克关系，判断趋势走向。

### 4️⃣ 看世应
世爻代表自己，应爻代表对方，分析双方态势。

### 5️⃣ 综合判断
加权计算输出最终吉凶。

## 📁 项目结构

```
算命/
├── main.py                 # 主程序入口
├── config.json             # API 配置
├── requirements.txt        # 依赖列表
│
├── core/                   # 核心引擎
│   ├── divination_engine.py   # 起卦引擎
│   ├── hexagram_analyzer.py   # 卦象分析
│   ├── najia_engine.py        # 纳甲排盘
│   ├── ganzhi.py              # 干支计算
│   ├── analysis_engine.py     # 五维分析引擎 ⭐
│   ├── llm_client.py          # LLM 调用
│   ├── context_loader.py      # 上下文加载
│   └── storage.py             # 历史存储
│
├── knowledge/              # 知识库
│   ├── hexagrams.json         # 64卦数据
│   ├── yao_ci.json            # 384爻辞
│   ├── bagua.json             # 八卦基础
│   ├── najia.json             # 纳甲配置
│   ├── divination_rules.json  # 断卦规则
│   └── modern_mapping.json    # 现代映射
│
├── data/                   # 运行时数据
│   └── history.json           # 历史记录
│
└── docs/                   # 文档
    └── architecture.md        # 架构说明
```

## 🔧 配置说明

`config.json` 完整配置：

```json
{
  "dashscope_api_key": "sk-xxx",
  "model": "qwen-plus",
  "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
  "temperature": 0.7,
  "max_tokens": 2000
}
```

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `model` | 模型名称 | qwen-plus |
| `temperature` | 创造性程度 | 0.7 |
| `max_tokens` | 最大输出长度 | 2000 |

## 🛠️ 开发指南

### 添加新的问事类型

1. 编辑 `core/analysis_engine.py` 中的 `YONG_SHEN_MAP`
2. 编辑 `knowledge/divination_rules.json` 添加断语
3. 更新 `main.py` 中的类型选项

### 调整评分权重

编辑 `core/analysis_engine.py`：

```python
WANG_SHUAI_SCORE = {
    "旺": 100, "相": 80, "休": 50, "囚": 30, "死": 10
}
```

### 自定义 Prompt

编辑 `core/llm_client.py` 中的 `SYSTEM_PROMPT`。

## 📊 技术亮点

1. **知识与推理分离** - LLM 不做逻辑判断，只负责语言生成
2. **量化评分体系** - 传统经验转化为可计算的公式
3. **动态上下文注入** - 每次起卦生成个性化 Prompt
4. **流式输出** - SSE 实时返回，用户体验好
5. **模块化设计** - 各引擎独立，易于测试和扩展

## 📜 免责声明

本项目仅供学习和娱乐目的。占卜结果不应作为重大人生决策的依据。命运掌握在自己手中。

## 📄 License

MIT License

---

**如果觉得有用，欢迎 Star ⭐**
